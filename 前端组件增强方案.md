# 前端组件增强方案

## 1. 数据可视化仪表板完整实现

### 1.1 仪表板主组件

```typescript
// bio-inventory-frontend/src/components/Dashboard.tsx 完整版

import React, { useState, useEffect } from 'react';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, PieChart, Pie, Cell, LineChart, Line } from 'recharts';
import { Package, AlertTriangle, TrendingUp, DollarSign, Plus, FileText, Search, Settings } from 'lucide-react';

interface DashboardStats {
  total_items: number;
  total_value: number;
  expired_items: number;
  expiring_soon: number;
  low_stock_items: number;
  categories: Array<{name: string; count: number}>;
}

const Dashboard: React.FC<{token: string}> = ({ token }) => {
  const [stats, setStats] = useState<DashboardStats | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchDashboardStats();
  }, []);

  const fetchDashboardStats = async () => {
    try {
      const response = await fetch('http://127.0.0.1:8000/api/items/dashboard_stats/', {
        headers: { 'Authorization': `Token ${token}` }
      });
      const data = await response.json();
      setStats(data);
    } catch (error) {
      console.error('获取仪表板数据失败:', error);
    } finally {
      setLoading(false);
    }
  };

  if (loading) {
    return (
      <div className="flex justify-center items-center h-64">
        <div className="loading-spinner w-8 h-8"></div>
      </div>
    );
  }

  if (!stats) {
    return <div className="text-center text-red-500">加载数据失败</div>;
  }

  const COLORS = ['#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6'];

  return (
    <div className="dashboard space-y-6 p-6">
      {/* 欢迎标题 */}
      <div className="mb-8">
        <h1 className="text-3xl font-bold text-gray-900 mb-2">实验室库存管理仪表板</h1>
        <p className="text-gray-600">实时监控您的库存状态和关键指标</p>
      </div>

      {/* 统计卡片 */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm font-medium text-gray-600">总物品数</p>
              <p className="text-3xl font-bold text-gray-900 mt-2">{stats.total_items.toLocaleString()}</p>
              <p className="text-sm text-green-600 mt-1">↑ 较上月增长 5%</p>
            </div>
            <div className="bg-blue-50 p-3 rounded-lg">
              <Package className="w-8 h-8 text-blue-600" />
            </div>
          </div>
        </div>

        <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm font-medium text-gray-600">总价值</p>
              <p className="text-3xl font-bold text-gray-900 mt-2">¥{stats.total_value.toLocaleString()}</p>
              <p className="text-sm text-green-600 mt-1">↑ 较上月增长 12%</p>
            </div>
            <div className="bg-green-50 p-3 rounded-lg">
              <DollarSign className="w-8 h-8 text-green-600" />
            </div>
          </div>
        </div>

        <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm font-medium text-gray-600">需要关注</p>
              <p className="text-3xl font-bold text-red-600 mt-2">{stats.expired_items + stats.expiring_soon}</p>
              <p className="text-sm text-red-600 mt-1">过期 + 即将过期</p>
            </div>
            <div className="bg-red-50 p-3 rounded-lg">
              <AlertTriangle className="w-8 h-8 text-red-600" />
            </div>
          </div>
        </div>

        <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition-shadow">
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm font-medium text-gray-600">低库存预警</p>
              <p className="text-3xl font-bold text-orange-600 mt-2">{stats.low_stock_items}</p>
              <p className="text-sm text-orange-600 mt-1">需要补货</p>
            </div>
            <div className="bg-orange-50 p-3 rounded-lg">
              <TrendingUp className="w-8 h-8 text-orange-600" />
            </div>
          </div>
        </div>
      </div>

      {/* 图表区域 */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* 物品类别分布 */}
        <div className="bg-white rounded-xl shadow-sm border border-gray-200">
          <div className="p-6 border-b border-gray-200">
            <h3 className="text-lg font-semibold text-gray-900">物品类别分布</h3>
            <p className="text-sm text-gray-600 mt-1">按类别查看库存分布情况</p>
          </div>
          <div className="p-6">
            <ResponsiveContainer width="100%" height={300}>
              <PieChart>
                <Pie
                  data={stats.categories}
                  cx="50%"
                  cy="50%"
                  labelLine={false}
                  label={({name, percent}) => `${name} ${(percent * 100).toFixed(0)}%`}
                  outerRadius={100}
                  fill="#8884d8"
                  dataKey="count"
                >
                  {stats.categories.map((entry, index) => (
                    <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />
                  ))}
                </Pie>
                <Tooltip formatter={(value, name) => [`${value} 个`, name]} />
              </PieChart>
            </ResponsiveContainer>
          </div>
        </div>

        {/* 库存状态概览 */}
        <div className="bg-white rounded-xl shadow-sm border border-gray-200">
          <div className="p-6 border-b border-gray-200">
            <h3 className="text-lg font-semibold text-gray-900">库存状态概览</h3>
            <p className="text-sm text-gray-600 mt-1">各种状态的物品数量统计</p>
          </div>
          <div className="p-6">
            <ResponsiveContainer width="100%" height={300}>
              <BarChart
                data={[
                  { 
                    name: '正常', 
                    count: stats.total_items - stats.expired_items - stats.expiring_soon - stats.low_stock_items,
                    color: '#10B981'
                  },
                  { name: '即将过期', count: stats.expiring_soon, color: '#F59E0B' },
                  { name: '已过期', count: stats.expired_items, color: '#EF4444' },
                  { name: '低库存', count: stats.low_stock_items, color: '#F97316' }
                ]}
              >
                <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
                <XAxis dataKey="name" tick={{fontSize: 12}} />
                <YAxis tick={{fontSize: 12}} />
                <Tooltip 
                  formatter={(value, name) => [`${value} 个`, name]}
                  labelStyle={{color: '#374151'}}
                />
                <Bar dataKey="count" radius={[4, 4, 0, 0]}>
                  {[
                    { name: '正常', count: stats.total_items - stats.expired_items - stats.expiring_soon - stats.low_stock_items, color: '#10B981' },
                    { name: '即将过期', count: stats.expiring_soon, color: '#F59E0B' },
                    { name: '已过期', count: stats.expired_items, color: '#EF4444' },
                    { name: '低库存', count: stats.low_stock_items, color: '#F97316' }
                  ].map((entry, index) => (
                    <Cell key={`cell-${index}`} fill={entry.color} />
                  ))}
                </Bar>
              </BarChart>
            </ResponsiveContainer>
          </div>
        </div>
      </div>

      {/* 快速操作和最近活动 */}
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {/* 快速操作 */}
        <div className="lg:col-span-2 bg-white rounded-xl shadow-sm border border-gray-200">
          <div className="p-6 border-b border-gray-200">
            <h3 className="text-lg font-semibold text-gray-900">快速操作</h3>
            <p className="text-sm text-gray-600 mt-1">常用功能快速访问</p>
          </div>
          <div className="p-6">
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
              <button className="flex flex-col items-center p-4 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors group">
                <div className="bg-blue-500 p-3 rounded-lg mb-3 group-hover:bg-blue-600 transition-colors">
                  <Plus className="w-6 h-6 text-white" />
                </div>
                <span className="text-sm font-medium text-gray-700">添加物品</span>
              </button>
              
              <button className="flex flex-col items-center p-4 bg-green-50 hover:bg-green-100 rounded-lg transition-colors group">
                <div className="bg-green-500 p-3 rounded-lg mb-3 group-hover:bg-green-600 transition-colors">
                  <Search className="w-6 h-6 text-white" />
                </div>
                <span className="text-sm font-medium text-gray-700">搜索库存</span>
              </button>
              
              <button className="flex flex-col items-center p-4 bg-purple-50 hover:bg-purple-100 rounded-lg transition-colors group">
                <div className="bg-purple-500 p-3 rounded-lg mb-3 group-hover:bg-purple-600 transition-colors">
                  <FileText className="w-6 h-6 text-white" />
                </div>
                <span className="text-sm font-medium text-gray-700">生成报告</span>
              </button>
              
              <button className="flex flex-col items-center p-4 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors group">
                <div className="bg-gray-500 p-3 rounded-lg mb-3 group-hover:bg-gray-600 transition-colors">
                  <Settings className="w-6 h-6 text-white" />
                </div>
                <span className="text-sm font-medium text-gray-700">系统设置</span>
              </button>
            </div>
          </div>
        </div>

        {/* 重要提醒 */}
        <div className="bg-white rounded-xl shadow-sm border border-gray-200">
          <div className="p-6 border-b border-gray-200">
            <h3 className="text-lg font-semibold text-gray-900">重要提醒</h3>
          </div>
          <div className="p-6 space-y-4">
            {stats.expired_items > 0 && (
              <div className="flex items-start space-x-3 p-3 bg-red-50 rounded-lg">
                <AlertTriangle className="w-5 h-5 text-red-500 mt-0.5" />
                <div>
                  <p className="text-sm font-medium text-red-800">
                    {stats.expired_items} 个物品已过期
                  </p>
                  <p className="text-xs text-red-600 mt-1">请及时处理过期物品</p>
                </div>
              </div>
            )}
            
            {stats.expiring_soon > 0 && (
              <div className="flex items-start space-x-3 p-3 bg-yellow-50 rounded-lg">
                <AlertTriangle className="w-5 h-5 text-yellow-500 mt-0.5" />
                <div>
                  <p className="text-sm font-medium text-yellow-800">
                    {stats.expiring_soon} 个物品即将过期
                  </p>
                  <p className="text-xs text-yellow-600 mt-1">建议优先使用</p>
                </div>
              </div>
            )}
            
            {stats.low_stock_items > 0 && (
              <div className="flex items-start space-x-3 p-3 bg-orange-50 rounded-lg">
                <Package className="w-5 h-5 text-orange-500 mt-0.5" />
                <div>
                  <p className="text-sm font-medium text-orange-800">
                    {stats.low_stock_items} 个物品库存不足
                  </p>
                  <p className="text-xs text-orange-600 mt-1">需要及时补货</p>
                </div>
              </div>
            )}
            
            {stats.expired_items === 0 && stats.expiring_soon === 0 && stats.low_stock_items === 0 && (
              <div className="text-center py-4">
                <div className="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                  <Package className="w-6 h-6 text-green-600" />
                </div>
                <p className="text-sm text-gray-600">库存状态良好</p>
                <p className="text-xs text-gray-500 mt-1">暂无需要关注的问题</p>
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
};

export default Dashboard;
```

## 2. 高级搜索组件

```typescript
// bio-inventory-frontend/src/components/AdvancedSearch.tsx

import React, { useState, useEffect } from 'react';
import { Search, Filter, X, Calendar, DollarSign, MapPin } from 'lucide-react';

interface SearchFilters {
  textSearch: string;
  categories: string[];
  vendors: string[];
  locations: string[];
  priceRange: [number, number];
  expirationDateRange: [string, string];
  stockLevel: 'all' | 'low' | 'normal' | 'high';
  customProperties: Record<string, any>;
}

interface AdvancedSearchProps {
  onSearch: (filters: SearchFilters) => void;
  onReset: () => void;
  token: string;
}

const AdvancedSearch: React.FC<AdvancedSearchProps> = ({ onSearch, onReset, token }) => {
  const [isOpen, setIsOpen] = useState(false);
  const [filters, setFilters] = useState<SearchFilters>({
    textSearch: '',
    categories: [],
    vendors: [],
    locations: [],
    priceRange: [0, 10000],
    expirationDateRange: ['', ''],
    stockLevel: 'all',
    customProperties: {}
  });

  const [options, setOptions] = useState({
    categories: [],
    vendors: [],
    locations: []
  });

  useEffect(() => {
    fetchOptions();
  }, []);

  const fetchOptions = async () => {
    try {
      const [categoriesRes, vendorsRes, locationsRes] = await Promise.all([
        fetch('http://127.0.0.1:8000/api/item-types/', {
          headers: { 'Authorization': `Token ${token}` }
        }),
        fetch('http://127.0.0.1:8000/api/vendors/', {
          headers: { 'Authorization': `Token ${token}` }
        }),
        fetch('http://127.0.0.1:8000/api/locations/', {
          headers: { 'Authorization': `Token ${token}` }
        })
      ]);

      const [categories, vendors, locations] = await Promise.all([
        categoriesRes.json(),
        vendorsRes.json(),
        locationsRes.json()
      ]);

      setOptions({ categories, vendors, locations });
    } catch (error) {
      console.error('获取搜索选项失败:', error);
    }
  };

  const handleSearch = () => {
    onSearch(filters);
    setIsOpen(false);
  };

  const handleReset = () => {
    const resetFilters = {
      textSearch: '',
      categories: [],
      vendors: [],
      locations: [],
      priceRange: [0, 10000] as [number, number],
      expirationDateRange: ['', ''] as [string, string],
      stockLevel: 'all' as const,
      customProperties: {}
    };
    setFilters(resetFilters);
    onReset();
  };

  const updateFilter = (key: keyof SearchFilters, value: any) => {
    setFilters(prev => ({ ...prev, [key]: value }));
  };

  const toggleArrayFilter = (key: 'categories' | 'vendors' | 'locations', value: string) => {
    setFilters(prev => ({
      ...prev,
      [key]: prev[key].includes(value)
        ? prev[key].filter(item => item !== value)
        : [...prev[key], value]
    }));
  };

  return (
    <div className="advanced-search">
      {/* 搜索栏 */}
      <div className="flex space-x-2 mb-4">
        <div className="flex-1 relative">
          <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" />
          <input
            type="text"
            placeholder="搜索物品名称、目录号、供应商..."
            className="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            value={filters.textSearch}
            onChange={(e) => updateFilter('textSearch', e.target.value)}
            onKeyPress={(e) => e.key === 'Enter' && handleSearch()}
          />
        </div>
        <button
          onClick={() => setIsOpen(!isOpen)}
          className={`px-4 py-3 border rounded-lg flex items-center space-x-2 transition-colors ${
            isOpen ? 'bg-blue-50 border-blue-300 text-blue-700' : 'border-gray-300 hover:bg-gray-50'
          }`}
        >
          <Filter className="w-5 h-5" />
          <span>高级筛选</span>
        </button>
        <button
          onClick={handleSearch}
          className="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
        >
          搜索
        </button>
      </div>

      {/* 高级筛选面板 */}
      {isOpen && (
        <div className="bg-white border border-gray-200 rounded-lg p-6 mb-4 shadow-sm">
          <div className="flex justify-between items-center mb-6">
            <h3 className="text-lg font-semibold text-gray-900">高级筛选</h3>
            <button
              onClick={() => setIsOpen(false)}
              className="p-2 hover:bg-gray-100 rounded-lg"
            >
              <X className="w-5 h-5 text-gray-500" />
            </button>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {/* 物品类别 */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">物品类别</label>
              <div className="space-y-2 max-h-40 overflow-y-auto">
                {options.categories.map((category: any) => (
                  <label key={category.id} className="flex items-center">
                    <input
                      type="checkbox"
                      className="rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                      checked={filters.categories.includes(category.id.toString())}
                      onChange={() => toggleArrayFilter('categories', category.id.toString())}
                    />
                    <span className="ml-2 text-sm text-gray-700">{category.name}</span>
                  </label>
                ))}
              </div>
            </div>

            {/* 供应商 */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">供应商</label>
              <div className="space-y-2 max-h-40 overflow-y-auto">
                {options.vendors.map((vendor: any) => (
                  <label key={vendor.id} className="flex items-center">
                    <input
                      type="checkbox"
                      className="rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                      checked={filters.vendors.includes(vendor.id.toString())}
                      onChange={() => toggleArrayFilter('vendors', vendor.id.toString())}
                    />
                    <span className="ml-2 text-sm text-gray-700">{vendor.name}</span>
                  </label>
                ))}
              </div>
            </div>

            {/* 存储位置 */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">存储位置</label>
              <div className="space-y-2 max-h-40 overflow-y-auto">
                {options.locations.map((location: any) => (
                  <label key={location.id} className="flex items-center">
                    <input
                      type="checkbox"
                      className="rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                      checked={filters.locations.includes(location.id.toString())}
                      onChange={() => toggleArrayFilter('locations', location.id.toString())}
                    />
                    <span className="ml-2 text-sm text-gray-700">{location.name}</span>
                  </label>
                ))}
              </div>
            </div>

            {/* 价格范围 */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                <DollarSign className="w-4 h-4 inline mr-1" />
                价格范围
              </label>
              <div className="space-y-3">
                <div className="flex space-x-2">
                  <input
                    type="number"
                    placeholder="最低价格"
                    className="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    value={filters.priceRange[0]}
                    onChange={(e) => updateFilter('priceRange', [Number(e.target.value), filters.priceRange[1]])}
                  />
                  <input
                    type="number"
                    placeholder="最高价格"
                    className="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    value={filters.priceRange[1]}
                    onChange={(e) => updateFilter('priceRange', [filters.priceRange[0], Number(e.target.value)])}
                  />
                </div>
              </div>
            </div>

            {/* 过期日期范围 */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">
                <Calendar className="w-4 h-4 inline mr-1" />
                过期日期范围
              </label>
              <div className="space-y-3">
                <input
                  type="date"
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  value={filters.expirationDateRange[0]}
                  onChange={(e) => updateFilter('expirationDateRange', [e.target.value, filters.expirationDateRange[1]])}
                />
                <input
                  type="date"
                  className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                  value={filters.expirationDateRange[1]}
                  onChange={(e) => updateFilter('expirationDateRange', [filters.expirationDateRange[0], e.target.value])}
                />
              </div>
            </div>

            {/* 库存水平 */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-3">库存水平</label>
              <select
                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                value={filters.stockLevel}
                onChange={(e) => updateFilter('stockLevel', e.target.value)}
              >
                <option value="all">全部</option>
                <option value="low">低库存</option>
                <option value="normal">正常</option>
                <option value="high">高库存</option>
              </select>
            </div>
          </div>

          {/* 操作按钮 */}
          <div className="flex justify-end space-x-3 mt-6 pt-6 border-t border-gray-200">
            <button
              onClick={handleReset}
              className="px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors"
            >
              重置筛选
            </button>
            <button
              onClick={handleSearch}
              className="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
            >
              应用筛选
            </button>
          </div>
        </div>
      )}

      {/* 活跃筛选标签 */}
      {(filters.categories.length > 0 || filters.vendors.length > 0 || filters.locations.length > 0) && (
        <div className="flex flex-wrap gap-2 mb-4">
          {filters.categories.map(categoryId => {
            const category = options.categories.find((c: any) => c.id.toString() === categoryId);
            return category ? (
              <span key={categoryId} className="inline-flex items-center px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full">
                类别: {category.name}
                <button
                  onClick={() => toggleArrayFilter('categories', categoryId)}
                  className="ml-2 hover:bg-blue-200 rounded-full p-0.5"
                >
                  <X className="w-3 h-3" />
                </button>
              </span>
            ) : null;
          })}
          
          {filters.vendors.map(vendorId => {
            const vendor = options.vendors.find((v: any) => v.id.toString() === vendorId);
            return vendor ? (
              <span key={vendorId} className="inline-flex items-center px-3 py-1 bg-green-100 text-green-800 text-sm rounded-full">
                供应商: {vendor.name}
                <button
                  onClick={() => toggleArrayFilter('vendors', vendorId)}
                  className="ml-2 hover:bg-green-200 rounded-full p-0.5"
                >
                  <X className="w-3 h-3" />
                </button>
              </span>
            ) : null;
          })}
          
          {filters.locations.map(locationId => {
            const location = options.locations.find((l: any) => l.id.toString() === locationId);
            return location ? (
              <span key={locationId} className="inline-flex items-center px-3 py-1 bg-purple-100 text-purple-800 text-sm rounded-full">
                位置: {location.name}
                <button
                  onClick={() => toggleArrayFilter('locations', locationId)}
                  className="ml-2 hover:bg-purple-200 rounded-full p-0.5"
                >
                  <X className="w-3 h-3" />
                </button>
              </span>
            ) : null;
          })}
        </div>
      )}
    </div>
  );
};

export default AdvancedSearch;